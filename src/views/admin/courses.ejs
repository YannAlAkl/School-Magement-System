<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Courses</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <div class="container">
        <div class="card">
            <div class="page-title">
                <div>
                    <h1>Manage Courses</h1>
                    <p class="subtitle">School Management System</p>
                </div>
                <button class="btn" onclick="openModal('addCourseModal', this)">+ Add Course</button>
            </div>

            <% if (error) { %>
                <div class="alert alert-error"><%= error %></div>
            <% } %>
            <% if (success) { %>
                <div class="alert alert-success"><%= success %></div>
            <% } %>

            <!-- List Courses -->
            <h2>Existing Courses</h2>
            <% if (courses && courses.length > 0) { %>
                <div class="table-wrap">
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Title</th>
                                <th>Description</th>
                                <th>Coef</th>
                                <th>Hours</th>
                                <th>Price</th>
                                <th style="width: 160px;">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% courses.forEach(course => { %>
                                <tr>
                                    <td><%= course.id %></td>
                                    <td><%= course.title %></td>
                                    <td><%= course.description.substring(0, 50) %><%= course.description.length > 50 ? '...' : '' %></td>
                                    <td><%= course.coeficient %></td>
                                    <td><%= course.course_hours %></td>
                                    <td>$<%= course.course_price %></td>
                                    <td>
                                        <div class="actions">
                                            <button class="btn btn-secondary btn-sm" onclick="openEditCourseModal('<%= course.id %>', '<%= course.title %>', '<%= course.description %>', '<%= course.coeficient %>', '<%= course.course_hours %>', '<%= course.course_price %>', this)">Edit</button>
                                            <button class="btn btn-danger btn-sm" onclick="openDeleteModal('<%= course.id %>', '<%= course.title %>', this)">Delete</button>
                                        </div>
                                    </td>
                                </tr>
                            <% }); %>
                        </tbody>
                    </table>
                </div>
            <% } else { %>
                <p>No courses found.</p>
            <% } %>
        </div>
    </div>

    <!-- Add Course Modal -->
    <div id="addCourseModal" class="modal">
        <div class="modal-content" style="width: 420px;">
            <div class="modal-header">
                <h2>Add New Course</h2>
                <button class="modal-close" onclick="closeModal('addCourseModal')">&times;</button>
            </div>
            <form action="/admin/courses/add" method="POST" class="modal-form">
                <div class="form-group">
                    <label for="course-title">Title</label>
                    <input type="text" id="course-title" name="title" required />
                </div>
                <div class="form-group">
                    <label for="course-description">Description</label>
                    <textarea id="course-description" name="description" required></textarea>
                </div>
                <div class="modal-form-row">
                    <div class="form-group">
                        <label for="course-coeficient">Coeficient</label>
                        <input type="number" id="course-coeficient" name="coeficient" step="0.01" required />
                    </div>
                    <div class="form-group">
                        <label for="course-hours">Hours</label>
                        <input type="number" id="course-hours" name="course_hours" required />
                    </div>
                </div>
                <div class="form-group">
                    <label for="course-price">Price ($)</label>
                    <input type="number" id="course-price" name="course_price" step="0.01" required />
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-ghost" onclick="closeModal('addCourseModal')">Cancel</button>
                    <button type="submit" class="btn">Add Course</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Course Modal -->
    <div id="editCourseModal" class="modal">
        <div class="modal-content" style="width: 420px;">
            <div class="modal-header">
                <h2>Edit Course</h2>
                <button class="modal-close" onclick="closeModal('editCourseModal')">&times;</button>
            </div>
            <form id="edit-course-form" action="/admin/courses" method="POST" class="modal-form">
                <input type="hidden" id="edit-course-id" name="id" />
                <div class="form-group">
                    <label for="edit-course-title">Title</label>
                    <input type="text" id="edit-course-title" name="title" required />
                </div>
                <div class="form-group">
                    <label for="edit-course-description">Description</label>
                    <textarea id="edit-course-description" name="description" required></textarea>
                </div>
                <div class="modal-form-row">
                    <div class="form-group">
                        <label for="edit-course-coeficient">Coeficient</label>
                        <input type="number" id="edit-course-coeficient" name="coeficient" step="0.01" required />
                    </div>
                    <div class="form-group">
                        <label for="edit-course-hours">Hours</label>
                        <input type="number" id="edit-course-hours" name="course_hours" required />
                    </div>
                </div>
                <div class="form-group">
                    <label for="edit-course-price">Price ($)</label>
                    <input type="number" id="edit-course-price" name="course_price" step="0.01" required />
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-ghost" onclick="closeModal('editCourseModal')">Cancel</button>
                    <button type="submit" class="btn">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="modal">
        <div class="modal-content" style="width: 320px;">
            <div class="modal-header">
                <h2>Confirm Delete</h2>
                <button class="modal-close" onclick="closeModal('deleteModal')">&times;</button>
            </div>
            <div class="modal-form">
                <p style="margin: 0 0 12px 0; color: var(--muted); font-size: 14px;">
                    Are you sure you want to delete course <strong id="delete-course-name"></strong>? This action cannot be undone.
                </p>
                <form id="delete-form" action="" method="POST" style="display: inline;">
                    <div class="modal-actions">
                        <button type="button" class="btn btn-ghost" onclick="closeModal('deleteModal')">Cancel</button>
                        <button type="submit" class="btn btn-danger">Delete</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        function openModal(modalId, btn) {
            const modal = document.getElementById(modalId);
            modal.classList.add('active');
            
            if (btn) {
                const modalContent = modal.querySelector('.modal-content');
                const rect = btn.getBoundingClientRect();
                
                modalContent.style.position = 'fixed';
                modalContent.style.top = (rect.top - 360) + 'px';
                modalContent.style.left = (rect.left - 150) + 'px';
            }
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function openEditCourseModal(id, title, description, coeficient, course_hours, course_price, btn) {
            document.getElementById('edit-course-id').value = id;
            document.getElementById('edit-course-title').value = title;
            document.getElementById('edit-course-description').value = description;
            document.getElementById('edit-course-coeficient').value = coeficient;
            document.getElementById('edit-course-hours').value = course_hours;
            document.getElementById('edit-course-price').value = course_price;
            document.getElementById('edit-course-form').action = '/admin/courses/' + id;
            openModal('editCourseModal', btn);
        }

        function openDeleteModal(id, title, btn) {
            document.getElementById('delete-course-name').textContent = title;
            document.getElementById('delete-form').action = '/admin/courses/' + id + '/delete';
            openModal('deleteModal', btn);
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.classList.remove('active');
            }
        }

        // Close modal with Escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                document.querySelectorAll('.modal.active').forEach(modal => {
                    modal.classList.remove('active');
                });
            }
        });
    </script>
</body>
</html>
